<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../../../">
  <title data-ice="title">(typhonjs-backbone-parse):<br>backbone/src/TyphonCollection.js | typhonjs-backbone-parse-todos API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/typhonjs-demos/typhonjs-backbone-parse-todos/typhonjs-backbone-parse-todos.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">backbone-es6/src</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/backbone-es6@master/src/Backbone.js~Backbone.html">Backbone</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/backbone-es6@master/src/Collection.js~Collection.html">Collection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/backbone-es6@master/src/Debug.js~Debug.html">Debug</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/backbone-es6@master/src/Events.js~Events.html">Events</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/backbone-es6@master/src/History.js~History.html">History</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/backbone-es6@master/src/Model.js~Model.html">Model</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/backbone-es6@master/src/Router.js~Router.html">Router</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/backbone-es6@master/src/Utils.js~Utils.html">Utils</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/backbone-es6@master/src/View.js~View.html">View</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extend">extend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sync">sync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BackboneProxy">BackboneProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-collection">collection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-model">model</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">backbone-parse-es6/src</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/backbone-parse-es6@master/src/ParseCollection.js~ParseCollection.html">ParseCollection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/backbone-parse-es6@master/src/ParseModel.js~ParseModel.html">ParseModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-modelExtend">modelExtend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseExtend">parseExtend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseSync">parseSync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-parseCollection">parseCollection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-parseModel">parseModel</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">(typhonjs-backbone-parse):<br>backbone/src</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/typhonjs-backbone-parse@master/src/TyphonCollection.js~TyphonCollection.html">TyphonCollection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/typhonjs-backbone-parse@master/src/TyphonEvents.js~TyphonEvents.html">TyphonEvents</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-typhonExtend">typhonExtend</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">typhonjs-core-backbone-query/src</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/jspm_packages/github/typhonjs/typhonjs-core-backbone-query@master/src/BackboneQuery.js~BackboneQuery.html">BackboneQuery</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">site/js</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/site/js/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">site/js/collections</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/site/js/collections/todoList.js~TodoList.html">TodoList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-todoList">todoList</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">site/js/models</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/site/js/models/Item.js~Item.html">Item</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/site/js/models/appState.js~AppState.html">AppState</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-appState">appState</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">site/js/router</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/site/js/router/AppRouter.js~AppRouter.html">AppRouter</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">site/js/views</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/site/js/views/ItemView.js~ItemView.html">ItemView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/site/js/views/LogInView.js~LogInView.html">LogInView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/typhonjs-backbone-parse-todos/site/js/views/ManageTodosView.js~ManageTodosView.html">ManageTodosView</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">(typhonjs-backbone-parse):<br>backbone/src/TyphonCollection.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

import _                from &apos;underscore&apos;;
import ParseCollection  from &apos;backbone-parse-es6/src/ParseCollection.js&apos;;

import BackboneQuery    from &apos;backbone-query&apos;;

/**
 * TyphonCollection - Collections are ordered sets of models. (http://backbonejs.org/#Collection)
 * -------------------
 *
 * This implementation of Backbone.Collection extends ParseCollection which provides a `parse` method that coverts the
 * response of a Parse.Query to ParseModels. One must set a Parse.Query instance as options.query or use a getter method
 * such as &quot;get query()&quot;.
 *
 * Please see the `ParseCollection` and `Collection` documentation for relevant information about the parent class /
 * implementation.
 *
 * TyphonCollection includes utility methods for sorting and returning sorted models. There are two
 * short form sorting methods: `filterBySortBy, sortByKey`.
 *
 * In addition TyphonCollection includes BackboneQuery support which supports local query / sorting of collections.
 * Additional methods: `find, findOne, resetQueryCache, sortAll, whereBy`.
 *
 * @see {@link BackboneQuery}
 *
 * @example
 *
 * If using Backbone-ES6 by ES6 source one can create a module for a Backbone.Collection:
 * import Backbone   from &apos;backbone&apos;;
 * import Parse      from &apos;parse&apos;;
 *
 * export default new Backbone.Collection(null,
 * {
 *    model: Backbone.Model.extend(...),
 *    query: new Parse.Query(&apos;&lt;TABLE_NAME&gt;&apos;)
 * });
 *
 * or if importing a specific model class
 *
 * import Backbone   from &apos;backbone&apos;;
 * import Parse      from &apos;parse&apos;;
 * import Model      from &apos;&lt;MY-BACKBONE-MODEL&gt;&apos;
 *
 * export default new Backbone.Collection(null,
 * {
 *    model: Model,
 *    query: new Parse.Query(&apos;&lt;TABLE_NAME&gt;&apos;)
 * });
 *
 * or use full ES6 style by using a getter for &quot;model&quot;:
 *
 * import Backbone   from &apos;backbone&apos;;
 * import Parse      from &apos;parse&apos;;
 * import Model      from &apos;&lt;MY-BACKBONE-MODEL&gt;&apos;
 *
 * const s_QUERY = new Parse.Query(&apos;&lt;TABLE_NAME&gt;&apos;);
 *
 * class MyCollection extends Backbone.Collection
 * {
 *    get model() { return Model; }
 *    get query() { return s_QUERY; }
 * }
 *
 * export default new MyCollection();   // If desired drop &quot;new&quot; to export the class itself and not an instance.
 */
export default class TyphonCollection extends ParseCollection
{
   /**
    * Filters this collection and then passes the results to `sortBy` to sort them.
    *
    * @param {function} filterFunc     - A function that works with `Collection.filter`.
    * @param {string}   sortKey        - Attribute key to sort by.
    * @param {boolean}  reverse        - Reverses the results.
    * @param {function} sortFunction   - A function that sorts the models by `Collection.sortBy` or `Array.sort`.
    * @returns {Array&lt;Model&gt;}
    */
   filterBySortBy(filterFunc, sortKey, reverse, sortFunction)
   {
      const first = this.first();
      if (_.isUndefined(first) || first === null) { return []; }

      if (!_.isFunction(filterFunc))
      {
         throw new Error(&quot;TyphonCollection.filterBySortBy - filterFunc is not a function.&quot;);
      }

      const filtered = this.filter(filterFunc);

      return this.sortByKey(sortKey, reverse, sortFunction, filtered);
   }

   /**
    * Sorts this collection.
    *
    * @param {string}   key            - Attribute key to sort by.
    * @param {boolean}  reverse        - Reverses the results.
    * @param {function} sortFunction   - A function that sorts the models by `Collection.sortBy` or `Array.sort`.
    * @param {Array&lt;Model&gt;} list       - A list to sort; provided for filterBySortBy to chain a list of models.
    * @returns {Array&lt;Model&gt;}
    */
   sortByKey(key, reverse, sortFunction, list)
   {
      const first = this.first();
      if (_.isUndefined(first) || first === null) { return []; }
      if (!first.has(key))
      {
         throw new Error(`Backbone.Collection.sortByKey - unknown key: ${key}`);
      }

      const firstValue = first.get(key);
      sortFunction = !_.isUndefined(sortFunction) ? sortFunction : null;

      if (sortFunction === null)
      {
         // Prepare Array based sort functions for common types.
         if (list)
         {
            if (_.isString(firstValue))
            {
               sortFunction = (a, b) =&gt; { return a.get(key).localeCompare(b.get(key)); };
            }
            else if (_.isNumber(firstValue))
            {
               sortFunction = (a, b) =&gt; { return a.get(key) &lt; b.get(key); };
            }
         }
         else
         {
            // Prepare underscore collection based sort function for alphabetical sorting
            if (_.isString(firstValue))
            {
               sortFunction = (entry) =&gt; { return entry.get(key).toLocaleLowerCase(); };
            }
         }
      }

      let sorted;

      // Use Array sort as it sorts in place and doesn&apos;t create a copy.
      if (list)
      {
         sorted = sortFunction !== null ? list.sort(sortFunction) : list.sort();
      }
      else // Use underscore sortBy function; unfortunately a copy is made.
      {
         sorted = this.sortBy(sortFunction !== null ? sortFunction : (entry) =&gt; { return entry.get(key); });
      }

      return reverse ? sorted.reverse() : sorted;
   }

// BackboneQuery delegation -----------------------------------------------------------------------------------------

   /**
    * Delegates to `BackboneQuery.find` to return an array of models that match the sort query.
    *
    * @param {string}   query    - A query string.
    * @param {Object}   options  - Optional parameters
    * @returns {Array&lt;Model&gt;}
    */
   find(query, options)
   {
      return BackboneQuery.find(this, query, options);
   }

   /**
    * Delegates to `BackboneQuery.findOne` to return the first model that matches the sort query.
    *
    * @param {string}   query    - A query string.
    * @returns {Model}
    */
   findOne(query)
   {
      return BackboneQuery.findOne(this, query);
   }

   /**
    * Delegates to `BackboneQuery.resetQueryCache` to reset this collections query cache.
    */
   resetQueryCache()
   {
      BackboneQuery.resetQueryCache(this);
   }

   /**
    * Delegates to `BackboneQuery.sortAll` to return all models that match the sort query.
    *
    * @param {string}   query    - A query string.
    * @returns {Array&lt;Model&gt;}
    */
   sortAll(query)
   {
      return BackboneQuery.sortAll(this, query);
   }

   /**
    * Delegates to `BackboneQuery.whereBy` to return a new collection with the models that match the sort query.
    *
    * @param {string}   query    - A query string.
    * @param {Object}   options  - Optional parameters
    * @returns {Collection}
    */
   whereBy(query, options)
   {
      return BackboneQuery.whereBy(this, query, options,
      {
         model: this.model,
         query: this.query,
         comparator: this.comparator
      });
   }
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.3)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
